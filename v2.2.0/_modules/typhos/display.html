<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>typhos.display &mdash; Typhos 2.2.0 documentation</title><link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  <script id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script src="../../_static/doctr-versions-menu.js"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../../index.html" class="icon icon-home"> Typhos
          </a>
              <div class="version">
                2.2.0
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption"><span class="caption-text">User Documentation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../basic_usage.html">How it Works</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tools.html">Supported Tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../save.html">Saving and Loading</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../connections.html">Application Connections</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../python_methods.html">Including Python Code</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../templates.html">Custom Templates</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../release_notes.html">Release History</a></li>
</ul>
<p class="caption"><span class="caption-text">Developer Documentation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../cli.html">Command Line Utilities</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../display.html">Suite and Displays</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../widgets.html">Widgets</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../plugins.html">Typhos Data Plugins for PyDM</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../utils.html">Utility Functions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../utils.html#cache-utilities">Cache Utilities</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Typhos</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="../index.html">Module code</a> &raquo;</li>
      <li>typhos.display</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for typhos.display</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;Contains the main display widget used for representing an entire device.&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">enum</span>
<span class="kn">import</span> <span class="nn">inspect</span>
<span class="kn">import</span> <span class="nn">logging</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">pathlib</span>
<span class="kn">import</span> <span class="nn">webbrowser</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">List</span><span class="p">,</span> <span class="n">Optional</span><span class="p">,</span> <span class="n">Union</span>

<span class="kn">import</span> <span class="nn">ophyd</span>
<span class="kn">import</span> <span class="nn">pcdsutils</span>
<span class="kn">import</span> <span class="nn">pydm.display</span>
<span class="kn">import</span> <span class="nn">pydm.exception</span>
<span class="kn">import</span> <span class="nn">pydm.utilities</span>
<span class="kn">from</span> <span class="nn">pcdsutils.qt</span> <span class="kn">import</span> <span class="n">forward_property</span>
<span class="kn">from</span> <span class="nn">qtpy</span> <span class="kn">import</span> <span class="n">QtCore</span><span class="p">,</span> <span class="n">QtGui</span><span class="p">,</span> <span class="n">QtWidgets</span>
<span class="kn">from</span> <span class="nn">qtpy.QtCore</span> <span class="kn">import</span> <span class="n">Q_ENUMS</span><span class="p">,</span> <span class="n">Property</span><span class="p">,</span> <span class="n">Qt</span><span class="p">,</span> <span class="n">Slot</span>

<span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">cache</span>
<span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">panel</span> <span class="k">as</span> <span class="n">typhos_panel</span>
<span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">utils</span><span class="p">,</span> <span class="n">web</span><span class="p">,</span> <span class="n">widgets</span>
<span class="kn">from</span> <span class="nn">.jira</span> <span class="kn">import</span> <span class="n">TyphosJiraIssueWidget</span>

<span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">DisplayTypes</span><span class="p">(</span><span class="n">enum</span><span class="o">.</span><span class="n">IntEnum</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Enumeration of template types that can be used in displays.&quot;&quot;&quot;</span>

    <span class="n">embedded_screen</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">detailed_screen</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">engineering_screen</span> <span class="o">=</span> <span class="mi">2</span>


<span class="n">_DisplayTypes</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">pyqt_class_from_enum</span><span class="p">(</span><span class="n">DisplayTypes</span><span class="p">)</span>
<span class="n">DisplayTypes</span><span class="o">.</span><span class="n">names</span> <span class="o">=</span> <span class="p">[</span><span class="n">view</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">view</span> <span class="ow">in</span> <span class="n">DisplayTypes</span><span class="p">]</span>


<span class="k">class</span> <span class="nc">ScrollOptions</span><span class="p">(</span><span class="n">enum</span><span class="o">.</span><span class="n">IntEnum</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Enumeration of scrollable options for displays.&quot;&quot;&quot;</span>

    <span class="n">auto</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">scrollbar</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">no_scroll</span> <span class="o">=</span> <span class="mi">2</span>


<span class="n">_ScrollOptions</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">pyqt_class_from_enum</span><span class="p">(</span><span class="n">ScrollOptions</span><span class="p">)</span>
<span class="n">ScrollOptions</span><span class="o">.</span><span class="n">names</span> <span class="o">=</span> <span class="p">[</span><span class="n">view</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">view</span> <span class="ow">in</span> <span class="n">ScrollOptions</span><span class="p">]</span>


<span class="n">DEFAULT_TEMPLATES</span> <span class="o">=</span> <span class="p">{</span>
    <span class="n">name</span><span class="p">:</span> <span class="p">[(</span><span class="n">utils</span><span class="o">.</span><span class="n">ui_dir</span> <span class="o">/</span> <span class="s1">&#39;core&#39;</span> <span class="o">/</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s1">.ui&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">resolve</span><span class="p">()]</span>
    <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">DisplayTypes</span><span class="o">.</span><span class="n">names</span>
<span class="p">}</span>

<span class="n">DETAILED_TREE_TEMPLATE</span> <span class="o">=</span> <span class="p">(</span><span class="n">utils</span><span class="o">.</span><span class="n">ui_dir</span> <span class="o">/</span> <span class="s1">&#39;core&#39;</span> <span class="o">/</span> <span class="s1">&#39;detailed_tree.ui&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">resolve</span><span class="p">()</span>
<span class="n">DEFAULT_TEMPLATES</span><span class="p">[</span><span class="s1">&#39;detailed_screen&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">DETAILED_TREE_TEMPLATE</span><span class="p">)</span>

<span class="n">DEFAULT_TEMPLATES_FLATTEN</span> <span class="o">=</span> <span class="p">[</span><span class="n">f</span> <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">files</span> <span class="ow">in</span> <span class="n">DEFAULT_TEMPLATES</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
                             <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">files</span><span class="p">]</span>


<div class="viewcode-block" id="normalize_display_type"><a class="viewcode-back" href="../../display.html#typhos.normalize_display_type">[docs]</a><span class="k">def</span> <span class="nf">normalize_display_type</span><span class="p">(</span>
    <span class="n">display_type</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">DisplayTypes</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DisplayTypes</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Normalize a given display type.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    display_type : DisplayTypes, str, or int</span>
<span class="sd">        The display type.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    display_type : DisplayTypes</span>
<span class="sd">        The normalized :class:`DisplayTypes`.</span>

<span class="sd">    Raises</span>
<span class="sd">    ------</span>
<span class="sd">    ValueError</span>
<span class="sd">        If the input cannot be made a :class:`DisplayTypes`.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">DisplayTypes</span><span class="p">(</span><span class="n">display_type</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">DisplayTypes</span><span class="p">[</span><span class="n">display_type</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s1">&#39;Unrecognized display type: </span><span class="si">{</span><span class="n">display_type</span><span class="si">}</span><span class="s1">&#39;</span>
            <span class="p">)</span></div>


<span class="k">def</span> <span class="nf">normalize_scroll_option</span><span class="p">(</span>
    <span class="n">scroll_option</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">ScrollOptions</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ScrollOptions</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Normalize a given scroll option.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    display_type : ScrollOptions, str, or int</span>
<span class="sd">        The display type.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    display_type : ScrollOptions</span>
<span class="sd">        The normalized :class:`ScrollOptions`.</span>

<span class="sd">    Raises</span>
<span class="sd">    ------</span>
<span class="sd">    ValueError</span>
<span class="sd">        If the input cannot be made a :class:`ScrollOptions`.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">ScrollOptions</span><span class="p">(</span><span class="n">scroll_option</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">ScrollOptions</span><span class="p">[</span><span class="n">scroll_option</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s1">&#39;Unrecognized scroll option: </span><span class="si">{</span><span class="n">scroll_option</span><span class="si">}</span><span class="s1">&#39;</span>
            <span class="p">)</span>


<div class="viewcode-block" id="TyphosToolButton"><a class="viewcode-back" href="../../display.html#typhos.TyphosToolButton">[docs]</a><span class="k">class</span> <span class="nc">TyphosToolButton</span><span class="p">(</span><span class="n">QtWidgets</span><span class="o">.</span><span class="n">QToolButton</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Base class for tool buttons used in the TyphosDisplaySwitcher.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    icon : QIcon or str, optional</span>
<span class="sd">        See :meth:`.get_icon` for options.</span>

<span class="sd">    parent : QtWidgets.QWidget, optional</span>
<span class="sd">        The parent widget.</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    DEFAULT_ICON : str</span>
<span class="sd">        The default icon from fontawesome to use.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">DEFAULT_ICON</span> <span class="o">=</span> <span class="s1">&#39;circle&#39;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">icon</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">parent</span><span class="o">=</span><span class="n">parent</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">setContextMenuPolicy</span><span class="p">(</span><span class="n">Qt</span><span class="o">.</span><span class="n">DefaultContextMenu</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">contextMenuEvent</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">open_context_menu</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_clicked</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setIcon</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_icon</span><span class="p">(</span><span class="n">icon</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setMinimumSize</span><span class="p">(</span><span class="mi">24</span><span class="p">,</span> <span class="mi">24</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_clicked</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Clicked callback: override in a subclass.&quot;&quot;&quot;</span>
        <span class="n">menu</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">generate_context_menu</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">menu</span><span class="p">:</span>
            <span class="n">menu</span><span class="o">.</span><span class="n">exec_</span><span class="p">(</span><span class="n">QtGui</span><span class="o">.</span><span class="n">QCursor</span><span class="o">.</span><span class="n">pos</span><span class="p">())</span>

<div class="viewcode-block" id="TyphosToolButton.generate_context_menu"><a class="viewcode-back" href="../../display.html#typhos.TyphosToolButton.generate_context_menu">[docs]</a>    <span class="k">def</span> <span class="nf">generate_context_menu</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Context menu request: override in subclasses.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="TyphosToolButton.get_icon"><a class="viewcode-back" href="../../display.html#typhos.TyphosToolButton.get_icon">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">get_icon</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">icon</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get a QIcon, if specified, or fall back to the default.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        icon : str or QtGui.QIcon</span>
<span class="sd">            If a string, assume it is from fontawesome.</span>
<span class="sd">            Otherwise, use the icon instance as-is.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">icon</span> <span class="o">=</span> <span class="n">icon</span> <span class="ow">or</span> <span class="bp">cls</span><span class="o">.</span><span class="n">DEFAULT_ICON</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">icon</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">pydm</span><span class="o">.</span><span class="n">utilities</span><span class="o">.</span><span class="n">IconFont</span><span class="p">()</span><span class="o">.</span><span class="n">icon</span><span class="p">(</span><span class="n">icon</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">icon</span></div>

<div class="viewcode-block" id="TyphosToolButton.open_context_menu"><a class="viewcode-back" href="../../display.html#typhos.TyphosToolButton.open_context_menu">[docs]</a>    <span class="k">def</span> <span class="nf">open_context_menu</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ev</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Open the instance-specific context menu.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        ev : QEvent</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">menu</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">generate_context_menu</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">menu</span><span class="p">:</span>
            <span class="n">menu</span><span class="o">.</span><span class="n">exec_</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mapToGlobal</span><span class="p">(</span><span class="n">ev</span><span class="o">.</span><span class="n">pos</span><span class="p">()))</span></div></div>


<div class="viewcode-block" id="TyphosDisplayConfigButton"><a class="viewcode-back" href="../../display.html#typhos.TyphosDisplayConfigButton">[docs]</a><span class="k">class</span> <span class="nc">TyphosDisplayConfigButton</span><span class="p">(</span><span class="n">TyphosToolButton</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The configuration button used in the :class:`TyphosDisplaySwitcher`.</span>

<span class="sd">    This uses the common &quot;vertical ellipse&quot; icon by default.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">DEFAULT_ICON</span> <span class="o">=</span> <span class="s1">&#39;ellipsis-v&#39;</span>

    <span class="n">_kind_to_property</span> <span class="o">=</span> <span class="n">typhos_panel</span><span class="o">.</span><span class="n">TyphosSignalPanel</span><span class="o">.</span><span class="n">_kind_to_property</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">icon</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">icon</span><span class="o">=</span><span class="n">icon</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="n">parent</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setPopupMode</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">InstantPopup</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setArrowType</span><span class="p">(</span><span class="n">Qt</span><span class="o">.</span><span class="n">NoArrow</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">templates</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">device_display</span> <span class="o">=</span> <span class="kc">None</span>

<div class="viewcode-block" id="TyphosDisplayConfigButton.set_device_display"><a class="viewcode-back" href="../../display.html#typhos.TyphosDisplayConfigButton.set_device_display">[docs]</a>    <span class="k">def</span> <span class="nf">set_device_display</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">device_display</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Typhos callback: set the :class:`TyphosDeviceDisplay`.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">device_display</span> <span class="o">=</span> <span class="n">device_display</span></div>

<div class="viewcode-block" id="TyphosDisplayConfigButton.create_kind_filter_menu"><a class="viewcode-back" href="../../display.html#typhos.TyphosDisplayConfigButton.create_kind_filter_menu">[docs]</a>    <span class="k">def</span> <span class="nf">create_kind_filter_menu</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">panels</span><span class="p">,</span> <span class="n">base_menu</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">only</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create the &quot;Kind&quot; filter menu.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        panels : list of TyphosSignalPanel</span>
<span class="sd">            The panels to filter upon triggering of menu actions.</span>

<span class="sd">        base_menu : QMenu</span>
<span class="sd">            The menu to add actions to.</span>

<span class="sd">        only : bool</span>
<span class="sd">            False - create &quot;Show Kind&quot; actions.</span>
<span class="sd">            True - create &quot;Show only Kind&quot; actions.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">kind</span><span class="p">,</span> <span class="n">prop</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_kind_to_property</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">def</span> <span class="nf">selected</span><span class="p">(</span><span class="n">new_value</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">prop</span><span class="o">=</span><span class="n">prop</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">only</span><span class="p">:</span>
                    <span class="c1"># Show *only* the specific kind for all panels</span>
                    <span class="k">for</span> <span class="n">kind</span><span class="p">,</span> <span class="n">current_prop</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_kind_to_property</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                        <span class="n">visible</span> <span class="o">=</span> <span class="p">(</span><span class="n">current_prop</span> <span class="o">==</span> <span class="n">prop</span><span class="p">)</span>
                        <span class="k">for</span> <span class="n">panel</span> <span class="ow">in</span> <span class="n">panels</span><span class="p">:</span>
                            <span class="nb">setattr</span><span class="p">(</span><span class="n">panel</span><span class="p">,</span> <span class="n">current_prop</span><span class="p">,</span> <span class="n">visible</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="c1"># Toggle visibility of the specific kind for all panels</span>
                    <span class="k">for</span> <span class="n">panel</span> <span class="ow">in</span> <span class="n">panels</span><span class="p">:</span>
                        <span class="nb">setattr</span><span class="p">(</span><span class="n">panel</span><span class="p">,</span> <span class="n">prop</span><span class="p">,</span> <span class="n">new_value</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">hide_empty</span><span class="p">()</span>

            <span class="n">title</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;Show only &amp;</span><span class="si">{</span><span class="n">kind</span><span class="si">}</span><span class="s1">&#39;</span> <span class="k">if</span> <span class="n">only</span> <span class="k">else</span> <span class="sa">f</span><span class="s1">&#39;Show &amp;</span><span class="si">{</span><span class="n">kind</span><span class="si">}</span><span class="s1">&#39;</span>
            <span class="n">action</span> <span class="o">=</span> <span class="n">base_menu</span><span class="o">.</span><span class="n">addAction</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">only</span><span class="p">:</span>
                <span class="n">action</span><span class="o">.</span><span class="n">setCheckable</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
                <span class="n">action</span><span class="o">.</span><span class="n">setChecked</span><span class="p">(</span><span class="nb">all</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="n">panel</span><span class="p">,</span> <span class="n">prop</span><span class="p">)</span>
                                      <span class="k">for</span> <span class="n">panel</span> <span class="ow">in</span> <span class="n">panels</span><span class="p">))</span>
            <span class="n">action</span><span class="o">.</span><span class="n">triggered</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">selected</span><span class="p">)</span></div>

<div class="viewcode-block" id="TyphosDisplayConfigButton.create_name_filter_menu"><a class="viewcode-back" href="../../display.html#typhos.TyphosDisplayConfigButton.create_name_filter_menu">[docs]</a>    <span class="k">def</span> <span class="nf">create_name_filter_menu</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">panels</span><span class="p">,</span> <span class="n">base_menu</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create the name-based filtering menu.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        panels : list of TyphosSignalPanel</span>
<span class="sd">            The panels to filter upon triggering of menu actions.</span>

<span class="sd">        base_menu : QMenu</span>
<span class="sd">            The menu to add actions to.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">def</span> <span class="nf">text_filter_updated</span><span class="p">():</span>
            <span class="n">text</span> <span class="o">=</span> <span class="n">line_edit</span><span class="o">.</span><span class="n">text</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">panel</span> <span class="ow">in</span> <span class="n">panels</span><span class="p">:</span>
                <span class="n">panel</span><span class="o">.</span><span class="n">nameFilter</span> <span class="o">=</span> <span class="n">text</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">hide_empty</span><span class="p">()</span>

        <span class="n">line_edit</span> <span class="o">=</span> <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QLineEdit</span><span class="p">()</span>

        <span class="n">filters</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">panel</span><span class="o">.</span><span class="n">nameFilter</span> <span class="k">for</span> <span class="n">panel</span> <span class="ow">in</span> <span class="n">panels</span>
                           <span class="k">if</span> <span class="n">panel</span><span class="o">.</span><span class="n">nameFilter</span><span class="p">))</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">filters</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">line_edit</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="n">filters</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">line_edit</span><span class="o">.</span><span class="n">setPlaceholderText</span><span class="p">(</span><span class="s1">&#39;/ &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">filters</span><span class="p">))</span>

        <span class="n">line_edit</span><span class="o">.</span><span class="n">editingFinished</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">text_filter_updated</span><span class="p">)</span>
        <span class="n">line_edit</span><span class="o">.</span><span class="n">setObjectName</span><span class="p">(</span><span class="s1">&#39;menu_action&#39;</span><span class="p">)</span>

        <span class="n">action</span> <span class="o">=</span> <span class="n">base_menu</span><span class="o">.</span><span class="n">addAction</span><span class="p">(</span><span class="s1">&#39;Filter by name:&#39;</span><span class="p">)</span>
        <span class="n">action</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>

        <span class="n">action</span> <span class="o">=</span> <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QWidgetAction</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">action</span><span class="o">.</span><span class="n">setDefaultWidget</span><span class="p">(</span><span class="n">line_edit</span><span class="p">)</span>
        <span class="n">base_menu</span><span class="o">.</span><span class="n">addAction</span><span class="p">(</span><span class="n">action</span><span class="p">)</span></div>

<div class="viewcode-block" id="TyphosDisplayConfigButton.hide_empty"><a class="viewcode-back" href="../../display.html#typhos.TyphosDisplayConfigButton.hide_empty">[docs]</a>    <span class="k">def</span> <span class="nf">hide_empty</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">search</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Wrap hide_empty calls for use with search functions and action clicks.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        search : bool</span>
<span class="sd">            Whether or not this method is being called from a search/filter</span>
<span class="sd">            method.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">device_display</span><span class="o">.</span><span class="n">hideEmpty</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">search</span><span class="p">:</span>
                <span class="n">show_empty</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">device_display</span><span class="p">)</span>
            <span class="n">hide_empty</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">device_display</span><span class="p">,</span> <span class="n">process_widget</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></div>

<div class="viewcode-block" id="TyphosDisplayConfigButton.create_hide_empty_menu"><a class="viewcode-back" href="../../display.html#typhos.TyphosDisplayConfigButton.create_hide_empty_menu">[docs]</a>    <span class="k">def</span> <span class="nf">create_hide_empty_menu</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">panels</span><span class="p">,</span> <span class="n">base_menu</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create the hide empty filtering menu.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        panels : list of TyphosSignalPanel</span>
<span class="sd">            The panels to filter upon triggering of menu actions.</span>

<span class="sd">        base_menu : QMenu</span>
<span class="sd">            The menu to add actions to.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">def</span> <span class="nf">handle_menu</span><span class="p">(</span><span class="n">checked</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">device_display</span><span class="o">.</span><span class="n">hideEmpty</span> <span class="o">=</span> <span class="n">checked</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">checked</span><span class="p">:</span>
                <span class="c1"># Force a reboot of the filters</span>
                <span class="c1"># since we no longer can figure what was supposed to be</span>
                <span class="c1"># visible or not</span>
                <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">panels</span><span class="p">:</span>
                    <span class="n">p</span><span class="o">.</span><span class="n">_update_panel</span><span class="p">()</span>
                <span class="n">show_empty</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">device_display</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">hide_empty</span><span class="p">(</span><span class="n">search</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

        <span class="n">action</span> <span class="o">=</span> <span class="n">base_menu</span><span class="o">.</span><span class="n">addAction</span><span class="p">(</span><span class="s1">&#39;Hide Empty Panels&#39;</span><span class="p">)</span>
        <span class="n">action</span><span class="o">.</span><span class="n">setCheckable</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">action</span><span class="o">.</span><span class="n">setChecked</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">device_display</span><span class="o">.</span><span class="n">hideEmpty</span><span class="p">)</span>
        <span class="n">action</span><span class="o">.</span><span class="n">triggered</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">handle_menu</span><span class="p">)</span></div>

<div class="viewcode-block" id="TyphosDisplayConfigButton.generate_context_menu"><a class="viewcode-back" href="../../display.html#typhos.TyphosDisplayConfigButton.generate_context_menu">[docs]</a>    <span class="k">def</span> <span class="nf">generate_context_menu</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Generate the custom context menu.</span>

<span class="sd">        .. code::</span>

<span class="sd">            Embedded</span>
<span class="sd">            Detailed</span>
<span class="sd">            Engineering</span>
<span class="sd">            -------------</span>
<span class="sd">            Refresh templates</span>
<span class="sd">            -------------</span>
<span class="sd">            Kind filter &gt; Show hinted</span>
<span class="sd">                          ...</span>
<span class="sd">                          Show only hinted</span>
<span class="sd">            Filter by name</span>
<span class="sd">            Hide Empty Panels</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">base_menu</span> <span class="o">=</span> <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QMenu</span><span class="p">(</span><span class="n">parent</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>

        <span class="n">display</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">device_display</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">display</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">base_menu</span>

        <span class="n">panels</span> <span class="o">=</span> <span class="n">display</span><span class="o">.</span><span class="n">findChildren</span><span class="p">(</span><span class="n">typhos_panel</span><span class="o">.</span><span class="n">TyphosSignalPanel</span><span class="p">)</span> <span class="ow">or</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">panels</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">base_menu</span>

        <span class="n">base_menu</span><span class="o">.</span><span class="n">addSection</span><span class="p">(</span><span class="s1">&#39;Templates&#39;</span><span class="p">)</span>
        <span class="n">display</span><span class="o">.</span><span class="n">_generate_template_menu</span><span class="p">(</span><span class="n">base_menu</span><span class="p">)</span>

        <span class="n">base_menu</span><span class="o">.</span><span class="n">addSection</span><span class="p">(</span><span class="s1">&#39;Filters&#39;</span><span class="p">)</span>
        <span class="n">filter_menu</span> <span class="o">=</span> <span class="n">base_menu</span><span class="o">.</span><span class="n">addMenu</span><span class="p">(</span><span class="s2">&quot;&amp;Kind filter&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">create_kind_filter_menu</span><span class="p">(</span><span class="n">panels</span><span class="p">,</span> <span class="n">filter_menu</span><span class="p">,</span> <span class="n">only</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">filter_menu</span><span class="o">.</span><span class="n">addSeparator</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">create_kind_filter_menu</span><span class="p">(</span><span class="n">panels</span><span class="p">,</span> <span class="n">filter_menu</span><span class="p">,</span> <span class="n">only</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">create_name_filter_menu</span><span class="p">(</span><span class="n">panels</span><span class="p">,</span> <span class="n">base_menu</span><span class="p">)</span>

        <span class="n">base_menu</span><span class="o">.</span><span class="n">addSeparator</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">create_hide_empty_menu</span><span class="p">(</span><span class="n">panels</span><span class="p">,</span> <span class="n">base_menu</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">utils</span><span class="o">.</span><span class="n">DEBUG_MODE</span><span class="p">:</span>
            <span class="n">base_menu</span><span class="o">.</span><span class="n">addSection</span><span class="p">(</span><span class="s1">&#39;Debug&#39;</span><span class="p">)</span>
            <span class="n">action</span> <span class="o">=</span> <span class="n">base_menu</span><span class="o">.</span><span class="n">addAction</span><span class="p">(</span><span class="s1">&#39;&amp;Copy to clipboard&#39;</span><span class="p">)</span>
            <span class="n">action</span><span class="o">.</span><span class="n">triggered</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">display</span><span class="o">.</span><span class="n">copy_to_clipboard</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">base_menu</span></div></div>


<div class="viewcode-block" id="TyphosDisplaySwitcherButton"><a class="viewcode-back" href="../../display.html#typhos.TyphosDisplaySwitcherButton">[docs]</a><span class="k">class</span> <span class="nc">TyphosDisplaySwitcherButton</span><span class="p">(</span><span class="n">TyphosToolButton</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;A button which switches the TyphosDeviceDisplay template on click.&quot;&quot;&quot;</span>

    <span class="n">template_selected</span> <span class="o">=</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Signal</span><span class="p">(</span><span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">)</span>

    <span class="n">icons</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;embedded_screen&#39;</span><span class="p">:</span> <span class="s1">&#39;compress&#39;</span><span class="p">,</span>
             <span class="s1">&#39;detailed_screen&#39;</span><span class="p">:</span> <span class="s1">&#39;braille&#39;</span><span class="p">,</span>
             <span class="s1">&#39;engineering_screen&#39;</span><span class="p">:</span> <span class="s1">&#39;cogs&#39;</span>
             <span class="p">}</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">display_type</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">icon</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">icons</span><span class="p">[</span><span class="n">display_type</span><span class="p">],</span> <span class="n">parent</span><span class="o">=</span><span class="n">parent</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">templates</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">_clicked</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Clicked callback - set the template.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">templates</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;set_device_display not called on </span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">template</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">templates</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">template_selected</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="n">template</span><span class="p">)</span>

<div class="viewcode-block" id="TyphosDisplaySwitcherButton.generate_context_menu"><a class="viewcode-back" href="../../display.html#typhos.TyphosDisplaySwitcherButton.generate_context_menu">[docs]</a>    <span class="k">def</span> <span class="nf">generate_context_menu</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Context menu request.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">templates</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="n">menu</span> <span class="o">=</span> <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QMenu</span><span class="p">(</span><span class="n">parent</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">template</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">templates</span><span class="p">:</span>
            <span class="k">def</span> <span class="nf">selected</span><span class="p">(</span><span class="o">*</span><span class="p">,</span> <span class="n">template</span><span class="o">=</span><span class="n">template</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">template_selected</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="n">template</span><span class="p">)</span>

            <span class="n">action</span> <span class="o">=</span> <span class="n">menu</span><span class="o">.</span><span class="n">addAction</span><span class="p">(</span><span class="n">template</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
            <span class="n">action</span><span class="o">.</span><span class="n">triggered</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">selected</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">menu</span></div></div>


<div class="viewcode-block" id="TyphosDisplaySwitcher"><a class="viewcode-back" href="../../display.html#typhos.TyphosDisplaySwitcher">[docs]</a><span class="k">class</span> <span class="nc">TyphosDisplaySwitcher</span><span class="p">(</span><span class="n">QtWidgets</span><span class="o">.</span><span class="n">QFrame</span><span class="p">,</span> <span class="n">widgets</span><span class="o">.</span><span class="n">TyphosDesignerMixin</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Display switcher set of buttons for use with a TyphosDeviceDisplay.&quot;&quot;&quot;</span>

    <span class="n">template_selected</span> <span class="o">=</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Signal</span><span class="p">(</span><span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="c1"># Intialize background variable</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">parent</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">device_display</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">buttons</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">layout</span> <span class="o">=</span> <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QHBoxLayout</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setLayout</span><span class="p">(</span><span class="n">layout</span><span class="p">)</span>
        <span class="n">layout</span><span class="o">.</span><span class="n">setSpacing</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">layout</span><span class="o">.</span><span class="n">setContentsMargins</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">setContextMenuPolicy</span><span class="p">(</span><span class="n">Qt</span><span class="o">.</span><span class="n">DefaultContextMenu</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">contextMenuEvent</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">open_context_menu</span>

        <span class="k">if</span> <span class="n">parent</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setParent</span><span class="p">(</span><span class="n">parent</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_create_ui</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_create_ui</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">layout</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">layout</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">buttons</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">help_button</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">config_button</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">help_toggle_button</span> <span class="o">=</span> <span class="n">TyphosHelpToggleButton</span><span class="p">()</span>
        <span class="n">layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">help_toggle_button</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">Qt</span><span class="o">.</span><span class="n">AlignRight</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">template_type</span> <span class="ow">in</span> <span class="n">DisplayTypes</span><span class="o">.</span><span class="n">names</span><span class="p">:</span>
            <span class="n">button</span> <span class="o">=</span> <span class="n">TyphosDisplaySwitcherButton</span><span class="p">(</span><span class="n">template_type</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">buttons</span><span class="p">[</span><span class="n">template_type</span><span class="p">]</span> <span class="o">=</span> <span class="n">button</span>
            <span class="n">button</span><span class="o">.</span><span class="n">template_selected</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_template_selected</span><span class="p">)</span>
            <span class="n">layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">button</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">Qt</span><span class="o">.</span><span class="n">AlignRight</span><span class="p">)</span>

            <span class="n">friendly_name</span> <span class="o">=</span> <span class="n">template_type</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">,</span> <span class="s1">&#39; &#39;</span><span class="p">)</span>
            <span class="n">button</span><span class="o">.</span><span class="n">setToolTip</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Switch to </span><span class="si">{</span><span class="n">friendly_name</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">config_button</span> <span class="o">=</span> <span class="n">TyphosDisplayConfigButton</span><span class="p">()</span>
        <span class="n">layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config_button</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">Qt</span><span class="o">.</span><span class="n">AlignRight</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">config_button</span><span class="o">.</span><span class="n">setToolTip</span><span class="p">(</span><span class="s1">&#39;Display settings...&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_template_selected</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">template</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Template selected hook.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">template_selected</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="n">template</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">device_display</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">device_display</span><span class="o">.</span><span class="n">force_template</span> <span class="o">=</span> <span class="n">template</span>

<div class="viewcode-block" id="TyphosDisplaySwitcher.set_device_display"><a class="viewcode-back" href="../../display.html#typhos.TyphosDisplaySwitcher.set_device_display">[docs]</a>    <span class="k">def</span> <span class="nf">set_device_display</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">display</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Typhos hook for setting the associated device display.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">device_display</span> <span class="o">=</span> <span class="n">display</span>

        <span class="k">for</span> <span class="n">template_type</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">buttons</span><span class="p">:</span>
            <span class="n">templates</span> <span class="o">=</span> <span class="n">display</span><span class="o">.</span><span class="n">templates</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">template_type</span><span class="p">,</span> <span class="p">[])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">buttons</span><span class="p">[</span><span class="n">template_type</span><span class="p">]</span><span class="o">.</span><span class="n">templates</span> <span class="o">=</span> <span class="n">templates</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">config_button</span><span class="o">.</span><span class="n">set_device_display</span><span class="p">(</span><span class="n">display</span><span class="p">)</span></div>

<div class="viewcode-block" id="TyphosDisplaySwitcher.add_device"><a class="viewcode-back" href="../../display.html#typhos.TyphosDisplaySwitcher.add_device">[docs]</a>    <span class="k">def</span> <span class="nf">add_device</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">device</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Typhos hook for setting the associated device.&quot;&quot;&quot;</span>
        <span class="o">...</span></div></div>


<div class="viewcode-block" id="TyphosTitleLabel"><a class="viewcode-back" href="../../display.html#typhos.TyphosTitleLabel">[docs]</a><span class="k">class</span> <span class="nc">TyphosTitleLabel</span><span class="p">(</span><span class="n">QtWidgets</span><span class="o">.</span><span class="n">QLabel</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A label class intended for use as a standardized title.</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    toggle_requested : QtCore.Signal</span>
<span class="sd">        A Qt signal indicating that the user clicked on the title.  By default,</span>
<span class="sd">        this hides any nested panels underneath the title.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">toggle_requested</span> <span class="o">=</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Signal</span><span class="p">()</span>

<div class="viewcode-block" id="TyphosTitleLabel.mousePressEvent"><a class="viewcode-back" href="../../display.html#typhos.TyphosTitleLabel.mousePressEvent">[docs]</a>    <span class="k">def</span> <span class="nf">mousePressEvent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Overridden qt hook for a mouse press.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">button</span><span class="p">()</span> <span class="o">==</span> <span class="n">Qt</span><span class="o">.</span><span class="n">LeftButton</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">toggle_requested</span><span class="o">.</span><span class="n">emit</span><span class="p">()</span>

        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">mousePressEvent</span><span class="p">(</span><span class="n">event</span><span class="p">)</span></div></div>


<span class="k">class</span> <span class="nc">TyphosHelpToggleButton</span><span class="p">(</span><span class="n">TyphosToolButton</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A standard button used to toggle help information display.</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    pop_out : QtCore.Signal</span>
<span class="sd">        A Qt signal indicating a request to pop out the help widget.</span>

<span class="sd">    open_in_browser : QtCore.Signal</span>
<span class="sd">        A Qt signal indicating a request to open the help in a browser.</span>

<span class="sd">    open_python_docs : QtCore.Signal</span>
<span class="sd">        A Qt signal indicating a request to open the Python docstring</span>
<span class="sd">        information.</span>

<span class="sd">    report_jira_issue : QtCore.Signal</span>
<span class="sd">        A Qt signal indicating a request to open the Jira issue reporting</span>
<span class="sd">        widget.</span>

<span class="sd">    toggle_help : QtCore.Signal</span>
<span class="sd">        A Qt signal indicating a request to toggle the related help display</span>
<span class="sd">        frame.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">pop_out</span> <span class="o">=</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Signal</span><span class="p">()</span>
    <span class="n">open_in_browser</span> <span class="o">=</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Signal</span><span class="p">()</span>
    <span class="n">open_python_docs</span> <span class="o">=</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Signal</span><span class="p">()</span>
    <span class="n">report_jira_issue</span> <span class="o">=</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Signal</span><span class="p">()</span>
    <span class="n">toggle_help</span> <span class="o">=</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Signal</span><span class="p">(</span><span class="nb">bool</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">icon</span><span class="o">=</span><span class="s2">&quot;question&quot;</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">icon</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="n">parent</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setCheckable</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_clicked</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Hook for QToolButton.clicked.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">toggle_help</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">isChecked</span><span class="p">())</span>

    <span class="k">def</span> <span class="nf">generate_context_menu</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">menu</span> <span class="o">=</span> <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QMenu</span><span class="p">(</span><span class="n">parent</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">open_in_browser</span> <span class="o">=</span> <span class="n">menu</span><span class="o">.</span><span class="n">addAction</span><span class="p">(</span><span class="s2">&quot;Pop &amp;out documentation...&quot;</span><span class="p">)</span>
        <span class="n">open_in_browser</span><span class="o">.</span><span class="n">triggered</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pop_out</span><span class="o">.</span><span class="n">emit</span><span class="p">)</span>

        <span class="n">open_in_browser</span> <span class="o">=</span> <span class="n">menu</span><span class="o">.</span><span class="n">addAction</span><span class="p">(</span><span class="s2">&quot;Open in &amp;browser...&quot;</span><span class="p">)</span>
        <span class="n">open_in_browser</span><span class="o">.</span><span class="n">triggered</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">open_in_browser</span><span class="o">.</span><span class="n">emit</span><span class="p">)</span>

        <span class="n">open_python_docs</span> <span class="o">=</span> <span class="n">menu</span><span class="o">.</span><span class="n">addAction</span><span class="p">(</span><span class="s2">&quot;Open &amp;Python docs...&quot;</span><span class="p">)</span>
        <span class="n">open_python_docs</span><span class="o">.</span><span class="n">triggered</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">open_python_docs</span><span class="o">.</span><span class="n">emit</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">toggle</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setChecked</span><span class="p">(</span><span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">isChecked</span><span class="p">())</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_clicked</span><span class="p">()</span>

        <span class="n">toggle_help</span> <span class="o">=</span> <span class="n">menu</span><span class="o">.</span><span class="n">addAction</span><span class="p">(</span><span class="s2">&quot;Toggle &amp;help&quot;</span><span class="p">)</span>
        <span class="n">toggle_help</span><span class="o">.</span><span class="n">triggered</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">toggle</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">utils</span><span class="o">.</span><span class="n">JIRA_URL</span><span class="p">:</span>
            <span class="n">menu</span><span class="o">.</span><span class="n">addSeparator</span><span class="p">()</span>
            <span class="n">report_issue</span> <span class="o">=</span> <span class="n">menu</span><span class="o">.</span><span class="n">addAction</span><span class="p">(</span><span class="s2">&quot;&amp;Report Jira issue...&quot;</span><span class="p">)</span>
            <span class="n">report_issue</span><span class="o">.</span><span class="n">triggered</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">report_jira_issue</span><span class="o">.</span><span class="n">emit</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">menu</span>


<span class="k">class</span> <span class="nc">TyphosHelpFrame</span><span class="p">(</span><span class="n">QtWidgets</span><span class="o">.</span><span class="n">QFrame</span><span class="p">,</span> <span class="n">widgets</span><span class="o">.</span><span class="n">TyphosDesignerMixin</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A frame for help information display.</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    tooltip_updated : QtCore.Signal</span>
<span class="sd">        A signal indicating the help tooltip has changed.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">tooltip_updated</span> <span class="o">=</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Signal</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">parent</span><span class="o">=</span><span class="n">parent</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">help</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">help_web_view</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_delete_timer</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">python_docs_browser</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">setContentsMargins</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

        <span class="n">layout</span> <span class="o">=</span> <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QVBoxLayout</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setLayout</span><span class="p">(</span><span class="n">layout</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">devices</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_jira_widget</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">new_jira_widget</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Open a new Jira issue reporting widget.&quot;&quot;&quot;</span>
        <span class="n">device</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">devices</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">devices</span> <span class="k">else</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_jira_widget</span> <span class="o">=</span> <span class="n">TyphosJiraIssueWidget</span><span class="p">(</span><span class="n">device</span><span class="o">=</span><span class="n">device</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_jira_widget</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">open_in_browser</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">new</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">autoraise</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Open the associated help documentation in the browser.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        new : int, optional</span>
<span class="sd">            0: the same browser window (the default).</span>
<span class="sd">            1: a new browser window.</span>
<span class="sd">            2: a new browser page (&quot;tab&quot;).</span>

<span class="sd">        autoraise : bool, optional</span>
<span class="sd">            If possible, autoraise raises the window (the default) or not.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">webbrowser</span><span class="o">.</span><span class="n">open</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">help_url</span><span class="o">.</span><span class="n">toString</span><span class="p">(),</span> <span class="n">new</span><span class="o">=</span><span class="n">new</span><span class="p">,</span> <span class="n">autoraise</span><span class="o">=</span><span class="n">autoraise</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">open_python_docs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Open the Python docstring information in a new window.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">python_docs_browser</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">python_docs_browser</span><span class="o">.</span><span class="n">raise_</span><span class="p">()</span>
            <span class="k">return</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">python_docs_browser</span> <span class="o">=</span> <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QTextBrowser</span><span class="p">()</span>
        <span class="n">help_document</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QTextDocument</span><span class="p">()</span>
        <span class="n">contents</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tooltip</span> <span class="ow">or</span> <span class="s2">&quot;Unset&quot;</span>
        <span class="n">first_line</span> <span class="o">=</span> <span class="n">contents</span><span class="o">.</span><span class="n">splitlines</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
        <span class="c1"># TODO: later versions of qt will support setMarkdown</span>
        <span class="n">help_document</span><span class="o">.</span><span class="n">setPlainText</span><span class="p">(</span><span class="n">contents</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">python_docs_browser</span><span class="o">.</span><span class="n">setWindowTitle</span><span class="p">(</span><span class="n">first_line</span><span class="p">)</span>
        <span class="n">font</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QFont</span><span class="p">(</span><span class="s2">&quot;Monospace&quot;</span><span class="p">)</span>
        <span class="n">font</span><span class="o">.</span><span class="n">setStyleHint</span><span class="p">(</span><span class="n">QtGui</span><span class="o">.</span><span class="n">QFont</span><span class="o">.</span><span class="n">TypeWriter</span><span class="p">)</span>
        <span class="c1"># font.setStyleHint(QtGui.QFont.Monospace)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">python_docs_browser</span><span class="o">.</span><span class="n">setFont</span><span class="p">(</span><span class="n">font</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">python_docs_browser</span><span class="o">.</span><span class="n">setDocument</span><span class="p">(</span><span class="n">help_document</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">python_docs_browser</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">python_docs_browser</span>

    <span class="k">def</span> <span class="nf">_get_tooltip</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Update the tooltip based on device information.&quot;&quot;&quot;</span>
        <span class="n">tooltip</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="c1"># BUG: I&#39;m seeing two devices in `self.devices` for</span>
        <span class="c1"># $ typhos --fake-device &#39;ophyd.EpicsMotor[{&quot;prefix&quot;:&quot;b&quot;}]&#39;</span>
        <span class="k">for</span> <span class="n">device</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span>
            <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">devices</span><span class="p">),</span>
            <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">dev</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">devices</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">dev</span><span class="p">)</span>
        <span class="p">):</span>
            <span class="n">heading</span> <span class="o">=</span> <span class="n">device</span><span class="o">.</span><span class="n">name</span> <span class="ow">or</span> <span class="nb">type</span><span class="p">(</span><span class="n">device</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span>
            <span class="n">tooltip</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span>
                <span class="n">heading</span><span class="p">,</span>
                <span class="s2">&quot;-&quot;</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">heading</span><span class="p">),</span>
                <span class="s2">&quot;&quot;</span>
            <span class="p">])</span>

            <span class="n">tooltip</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="n">inspect</span><span class="o">.</span><span class="n">getdoc</span><span class="p">(</span><span class="n">device</span><span class="p">)</span> <span class="ow">or</span>
                <span class="n">inspect</span><span class="o">.</span><span class="n">getdoc</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">device</span><span class="p">))</span> <span class="ow">or</span>
                <span class="s2">&quot;No docstring&quot;</span>
            <span class="p">)</span>
            <span class="n">tooltip</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">tooltip</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">add_device</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">device</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">devices</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_tooltip</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_tooltip</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tooltip_updated</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_tooltip</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">setWindowTitle</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Help: </span><span class="si">{</span><span class="n">device</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">help_url</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;The full help URL, generated from ``TYPHOS_HELP_URL``.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">devices</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">QUrl</span><span class="p">(</span><span class="s2">&quot;about:blank&quot;</span><span class="p">)</span>

        <span class="n">device</span><span class="p">,</span> <span class="o">*</span><span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">devices</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">device_url</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">HELP_URL</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">device</span><span class="o">=</span><span class="n">device</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="s2">&quot;Failed to format confluence URL for device </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span>
                             <span class="n">device</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">QUrl</span><span class="p">(</span><span class="s2">&quot;about:blank&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">QUrl</span><span class="p">(</span><span class="n">device_url</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">show_help</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Show the help information in a QWebEngineView.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">web</span><span class="o">.</span><span class="n">TyphosWebEngineView</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
                <span class="s2">&quot;Failed to import QWebEngineView; &quot;</span>
                <span class="s2">&quot;help view is unavailable.&quot;</span>
                <span class="p">)</span>
            <span class="k">return</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">help_web_view</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">help_web_view</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
            <span class="k">return</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">help_web_view</span> <span class="o">=</span> <span class="n">web</span><span class="o">.</span><span class="n">TyphosWebEngineView</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">help_web_view</span><span class="o">.</span><span class="n">page</span><span class="p">()</span><span class="o">.</span><span class="n">setUrl</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">help_url</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">help_web_view</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">help_web_view</span><span class="o">.</span><span class="n">setMinimumSize</span><span class="p">(</span><span class="n">QtCore</span><span class="o">.</span><span class="n">QSize</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">400</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">layout</span><span class="p">()</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">help_web_view</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">hide_help</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Hide the help information QWebEngineView.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">help_web_view</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">help_web_view</span><span class="o">.</span><span class="n">hide</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_delete_timer</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_delete_timer</span> <span class="o">=</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">QTimer</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_delete_timer</span><span class="o">.</span><span class="n">setInterval</span><span class="p">(</span><span class="mi">20000</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_delete_timer</span><span class="o">.</span><span class="n">setSingleShot</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_delete_timer</span><span class="o">.</span><span class="n">timeout</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_delete_help_if_hidden</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_delete_timer</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_delete_help_if_hidden</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Slowly react to the help display removal, as setting it back up can be</span>
<span class="sd">        slow and painful.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_delete_timer</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">help_web_view</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">help_web_view</span><span class="o">.</span><span class="n">isVisible</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">layout</span><span class="p">()</span><span class="o">.</span><span class="n">removeWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">help_web_view</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">help_web_view</span><span class="o">.</span><span class="n">deleteLater</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">help_web_view</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">toggle_help</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">show</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Toggle the visibility of the help information QWebEngineView.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        show : bool</span>
<span class="sd">            Show the help (True) or hide it (False).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">devices</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;No devices added -&gt; no help&quot;</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="k">if</span> <span class="n">show</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">show_help</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">hide_help</span><span class="p">()</span>


<div class="viewcode-block" id="TyphosDisplayTitle"><a class="viewcode-back" href="../../display.html#typhos.TyphosDisplayTitle">[docs]</a><span class="k">class</span> <span class="nc">TyphosDisplayTitle</span><span class="p">(</span><span class="n">QtWidgets</span><span class="o">.</span><span class="n">QFrame</span><span class="p">,</span> <span class="n">widgets</span><span class="o">.</span><span class="n">TyphosDesignerMixin</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Standardized Typhos Device Display title.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    title : str, optional</span>
<span class="sd">        The initial title text, which may contain macros.</span>

<span class="sd">    show_switcher : bool, optional</span>
<span class="sd">        Show the :class:`TyphosDisplaySwitcher`.</span>

<span class="sd">    show_underline : bool, optional</span>
<span class="sd">        Show the underline separator.</span>

<span class="sd">    parent : QtWidgets.QWidget, optional</span>
<span class="sd">        The parent widget.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;$</span><span class="si">{name}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">show_switcher</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                 <span class="n">show_underline</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_show_underline</span> <span class="o">=</span> <span class="n">show_underline</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_show_switcher</span> <span class="o">=</span> <span class="n">show_switcher</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">parent</span><span class="o">=</span><span class="n">parent</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">label</span> <span class="o">=</span> <span class="n">TyphosTitleLabel</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">switcher</span> <span class="o">=</span> <span class="n">TyphosDisplaySwitcher</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">underline</span> <span class="o">=</span> <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QFrame</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">underline</span><span class="o">.</span><span class="n">setFrameShape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">underline</span><span class="o">.</span><span class="n">HLine</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">underline</span><span class="o">.</span><span class="n">setFrameShadow</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">underline</span><span class="o">.</span><span class="n">Plain</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">underline</span><span class="o">.</span><span class="n">setLineWidth</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">grid_layout</span> <span class="o">=</span> <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QGridLayout</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">grid_layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">label</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">grid_layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">switcher</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">Qt</span><span class="o">.</span><span class="n">AlignRight</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">grid_layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">underline</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">utils</span><span class="o">.</span><span class="n">HELP_URL</span><span class="p">:</span>
            <span class="c1"># The help widget is entirely optional, based on environment</span>
            <span class="c1"># settings.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">help</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">help</span> <span class="o">=</span> <span class="n">TyphosHelpFrame</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">switcher</span><span class="o">.</span><span class="n">help_toggle_button</span><span class="o">.</span><span class="n">toggle_help</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">toggle_help</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">switcher</span><span class="o">.</span><span class="n">help_toggle_button</span><span class="o">.</span><span class="n">pop_out</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">pop_out_help</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">switcher</span><span class="o">.</span><span class="n">help_toggle_button</span><span class="o">.</span><span class="n">open_in_browser</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">help</span><span class="o">.</span><span class="n">open_in_browser</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">switcher</span><span class="o">.</span><span class="n">help_toggle_button</span><span class="o">.</span><span class="n">open_python_docs</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">help</span><span class="o">.</span><span class="n">open_python_docs</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">switcher</span><span class="o">.</span><span class="n">help_toggle_button</span><span class="o">.</span><span class="n">report_jira_issue</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">help</span><span class="o">.</span><span class="n">new_jira_widget</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">help</span><span class="o">.</span><span class="n">tooltip_updated</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">switcher</span><span class="o">.</span><span class="n">help_toggle_button</span><span class="o">.</span><span class="n">setToolTip</span>
            <span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">grid_layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">help</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">grid_layout</span><span class="o">.</span><span class="n">setSizeConstraint</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">grid_layout</span><span class="o">.</span><span class="n">SetMinimumSize</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setLayout</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">grid_layout</span><span class="p">)</span>

        <span class="c1"># Set the property:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">show_switcher</span> <span class="o">=</span> <span class="n">show_switcher</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">show_underline</span> <span class="o">=</span> <span class="n">show_underline</span>

<div class="viewcode-block" id="TyphosDisplayTitle.toggle_help"><a class="viewcode-back" href="../../display.html#typhos.TyphosDisplayTitle.toggle_help">[docs]</a>    <span class="k">def</span> <span class="nf">toggle_help</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">show</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Toggle the help visibility.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">help</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">help</span><span class="o">.</span><span class="n">toggle_help</span><span class="p">(</span><span class="n">show</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">help</span><span class="o">.</span><span class="n">parent</span><span class="p">()</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">grid_layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">help</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span></div>

<div class="viewcode-block" id="TyphosDisplayTitle.pop_out_help"><a class="viewcode-back" href="../../display.html#typhos.TyphosDisplayTitle.pop_out_help">[docs]</a>    <span class="k">def</span> <span class="nf">pop_out_help</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Pop out the help widget.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">help</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">help</span><span class="o">.</span><span class="n">setParent</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">switcher</span><span class="o">.</span><span class="n">help_toggle_button</span><span class="o">.</span><span class="n">setChecked</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">help</span><span class="o">.</span><span class="n">show_help</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">help</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">help</span><span class="o">.</span><span class="n">raise_</span><span class="p">()</span></div>

    <span class="nd">@Property</span><span class="p">(</span><span class="nb">bool</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">show_switcher</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get or set whether to show the display switcher.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_show_switcher</span>

    <span class="nd">@show_switcher</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">show_switcher</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_show_switcher</span> <span class="o">=</span> <span class="nb">bool</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">switcher</span><span class="o">.</span><span class="n">setVisible</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_show_switcher</span><span class="p">)</span>

<div class="viewcode-block" id="TyphosDisplayTitle.add_device"><a class="viewcode-back" href="../../display.html#typhos.TyphosDisplayTitle.add_device">[docs]</a>    <span class="k">def</span> <span class="nf">add_device</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">device</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Typhos hook for setting the associated device.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">label</span><span class="o">.</span><span class="n">text</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">label</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="n">device</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">help</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">help</span><span class="o">.</span><span class="n">add_device</span><span class="p">(</span><span class="n">device</span><span class="p">)</span></div>

    <span class="nd">@QtCore</span><span class="o">.</span><span class="n">Property</span><span class="p">(</span><span class="nb">bool</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">show_underline</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get or set whether to show the underline.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_show_underline</span>

    <span class="nd">@show_underline</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">show_underline</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_show_underline</span> <span class="o">=</span> <span class="nb">bool</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">underline</span><span class="o">.</span><span class="n">setVisible</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_show_underline</span><span class="p">)</span>

<div class="viewcode-block" id="TyphosDisplayTitle.set_device_display"><a class="viewcode-back" href="../../display.html#typhos.TyphosDisplayTitle.set_device_display">[docs]</a>    <span class="k">def</span> <span class="nf">set_device_display</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">display</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Typhos callback: set the :class:`TyphosDeviceDisplay`.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">device_display</span> <span class="o">=</span> <span class="n">display</span>

        <span class="k">def</span> <span class="nf">toggle</span><span class="p">():</span>
            <span class="n">toggle_display</span><span class="p">(</span><span class="n">display</span><span class="o">.</span><span class="n">display_widget</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">label</span><span class="o">.</span><span class="n">toggle_requested</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">toggle</span><span class="p">)</span></div>

    <span class="c1"># Make designable properties from the title label available here as well</span>
    <span class="n">label_alignment</span> <span class="o">=</span> <span class="n">forward_property</span><span class="p">(</span><span class="s1">&#39;label&#39;</span><span class="p">,</span> <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QLabel</span><span class="p">,</span> <span class="s1">&#39;alignment&#39;</span><span class="p">)</span>
    <span class="n">label_font</span> <span class="o">=</span> <span class="n">forward_property</span><span class="p">(</span><span class="s1">&#39;label&#39;</span><span class="p">,</span> <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QLabel</span><span class="p">,</span> <span class="s1">&#39;font&#39;</span><span class="p">)</span>
    <span class="n">label_indent</span> <span class="o">=</span> <span class="n">forward_property</span><span class="p">(</span><span class="s1">&#39;label&#39;</span><span class="p">,</span> <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QLabel</span><span class="p">,</span> <span class="s1">&#39;indent&#39;</span><span class="p">)</span>
    <span class="n">label_margin</span> <span class="o">=</span> <span class="n">forward_property</span><span class="p">(</span><span class="s1">&#39;label&#39;</span><span class="p">,</span> <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QLabel</span><span class="p">,</span> <span class="s1">&#39;margin&#39;</span><span class="p">)</span>
    <span class="n">label_openExternalLinks</span> <span class="o">=</span> <span class="n">forward_property</span><span class="p">(</span><span class="s1">&#39;label&#39;</span><span class="p">,</span> <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QLabel</span><span class="p">,</span>
                                               <span class="s1">&#39;openExternalLinks&#39;</span><span class="p">)</span>
    <span class="n">label_pixmap</span> <span class="o">=</span> <span class="n">forward_property</span><span class="p">(</span><span class="s1">&#39;label&#39;</span><span class="p">,</span> <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QLabel</span><span class="p">,</span> <span class="s1">&#39;pixmap&#39;</span><span class="p">)</span>
    <span class="n">label_text</span> <span class="o">=</span> <span class="n">forward_property</span><span class="p">(</span><span class="s1">&#39;label&#39;</span><span class="p">,</span> <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QLabel</span><span class="p">,</span> <span class="s1">&#39;text&#39;</span><span class="p">)</span>
    <span class="n">label_textFormat</span> <span class="o">=</span> <span class="n">forward_property</span><span class="p">(</span><span class="s1">&#39;label&#39;</span><span class="p">,</span> <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QLabel</span><span class="p">,</span>
                                        <span class="s1">&#39;textFormat&#39;</span><span class="p">)</span>
    <span class="n">label_textInteractionFlags</span> <span class="o">=</span> <span class="n">forward_property</span><span class="p">(</span><span class="s1">&#39;label&#39;</span><span class="p">,</span> <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QLabel</span><span class="p">,</span>
                                                  <span class="s1">&#39;textInteractionFlags&#39;</span><span class="p">)</span>
    <span class="n">label_wordWrap</span> <span class="o">=</span> <span class="n">forward_property</span><span class="p">(</span><span class="s1">&#39;label&#39;</span><span class="p">,</span> <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QLabel</span><span class="p">,</span> <span class="s1">&#39;wordWrap&#39;</span><span class="p">)</span>

    <span class="c1"># Make designable properties from the grid_layout</span>
    <span class="n">layout_margin</span> <span class="o">=</span> <span class="n">forward_property</span><span class="p">(</span><span class="s1">&#39;grid_layout&#39;</span><span class="p">,</span> <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QHBoxLayout</span><span class="p">,</span>
                                     <span class="s1">&#39;margin&#39;</span><span class="p">)</span>
    <span class="n">layout_spacing</span> <span class="o">=</span> <span class="n">forward_property</span><span class="p">(</span><span class="s1">&#39;grid_layout&#39;</span><span class="p">,</span> <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QHBoxLayout</span><span class="p">,</span>
                                      <span class="s1">&#39;spacing&#39;</span><span class="p">)</span>

    <span class="c1"># Make designable properties from the underline</span>
    <span class="n">underline_palette</span> <span class="o">=</span> <span class="n">forward_property</span><span class="p">(</span><span class="s1">&#39;underline&#39;</span><span class="p">,</span> <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QFrame</span><span class="p">,</span>
                                         <span class="s1">&#39;palette&#39;</span><span class="p">)</span>
    <span class="n">underline_styleSheet</span> <span class="o">=</span> <span class="n">forward_property</span><span class="p">(</span><span class="s1">&#39;underline&#39;</span><span class="p">,</span> <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QFrame</span><span class="p">,</span>
                                            <span class="s1">&#39;styleSheet&#39;</span><span class="p">)</span>
    <span class="n">underline_lineWidth</span> <span class="o">=</span> <span class="n">forward_property</span><span class="p">(</span><span class="s1">&#39;underline&#39;</span><span class="p">,</span> <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QFrame</span><span class="p">,</span>
                                           <span class="s1">&#39;lineWidth&#39;</span><span class="p">)</span>
    <span class="n">underline_midLineWidth</span> <span class="o">=</span> <span class="n">forward_property</span><span class="p">(</span><span class="s1">&#39;underline&#39;</span><span class="p">,</span> <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QFrame</span><span class="p">,</span>
                                              <span class="s1">&#39;midLineWidth&#39;</span><span class="p">)</span></div>


<div class="viewcode-block" id="TyphosDeviceDisplay"><a class="viewcode-back" href="../../display.html#typhos.TyphosDeviceDisplay">[docs]</a><span class="k">class</span> <span class="nc">TyphosDeviceDisplay</span><span class="p">(</span><span class="n">utils</span><span class="o">.</span><span class="n">TyphosBase</span><span class="p">,</span> <span class="n">widgets</span><span class="o">.</span><span class="n">TyphosDesignerMixin</span><span class="p">,</span>
                          <span class="n">_DisplayTypes</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Main display for a single ophyd Device.</span>

<span class="sd">    This contains the widgets for all of the root devices signals, and any</span>
<span class="sd">    methods you would like to display. By typhos convention, the base</span>
<span class="sd">    initialization sets up the widgets and the :meth:`.from_device` class</span>
<span class="sd">    method will automatically populate the resulting display.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    parent : QWidget, optional</span>
<span class="sd">        The parent widget.</span>

<span class="sd">    scrollable : bool, optional</span>
<span class="sd">        Semi-deprecated parameter. Use scroll_option instead.</span>
<span class="sd">        If ``True``, put the loaded template into a :class:`QScrollArea`.</span>
<span class="sd">        If ``False``, the display widget will go directly in this widget&#39;s</span>
<span class="sd">        layout.</span>
<span class="sd">        If omitted, scroll_option is used instead.</span>

<span class="sd">    composite_heuristics : bool, optional</span>
<span class="sd">        Enable composite heuristics, which may change the suggested detailed</span>
<span class="sd">        screen based on the contents of the added device.  See also</span>
<span class="sd">        :meth:`.suggest_composite_screen`.</span>

<span class="sd">    embedded_templates : list, optional</span>
<span class="sd">        List of embedded templates to use in addition to those found on disk.</span>

<span class="sd">    detailed_templates : list, optional</span>
<span class="sd">        List of detailed templates to use in addition to those found on disk.</span>

<span class="sd">    engineering_templates : list, optional</span>
<span class="sd">        List of engineering templates to use in addition to those found on</span>
<span class="sd">        disk.</span>

<span class="sd">    display_type : DisplayTypes, str, or int, optional</span>
<span class="sd">        The default display type.</span>

<span class="sd">    scroll_option : ScrollOptions, str, or int, optional</span>
<span class="sd">        The scroll behavior.</span>

<span class="sd">    nested : bool, optional</span>
<span class="sd">        An optional annotation for a display that may be nested inside another.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Template types and defaults</span>
    <span class="n">Q_ENUMS</span><span class="p">(</span><span class="n">_DisplayTypes</span><span class="p">)</span>
    <span class="n">TemplateEnum</span> <span class="o">=</span> <span class="n">DisplayTypes</span>  <span class="c1"># For convenience</span>

    <span class="n">device_count_threshold</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">signal_count_threshold</span> <span class="o">=</span> <span class="mi">30</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">parent</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">QtWidgets</span><span class="o">.</span><span class="n">QWidget</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">scrollable</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">composite_heuristics</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">embedded_templates</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">detailed_templates</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">engineering_templates</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">display_type</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">DisplayTypes</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;detailed_screen&#39;</span><span class="p">,</span>
        <span class="n">scroll_option</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">ScrollOptions</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;auto&#39;</span><span class="p">,</span>
        <span class="n">nested</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_composite_heuristics</span> <span class="o">=</span> <span class="n">composite_heuristics</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_current_template</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_forced_template</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_macros</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_display_widget</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_scroll_option</span> <span class="o">=</span> <span class="n">ScrollOptions</span><span class="o">.</span><span class="n">no_scroll</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_searched</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_hide_empty</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_nested</span> <span class="o">=</span> <span class="n">nested</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">templates</span> <span class="o">=</span> <span class="p">{</span><span class="n">name</span><span class="p">:</span> <span class="p">[]</span> <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">DisplayTypes</span><span class="o">.</span><span class="n">names</span><span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_display_type</span> <span class="o">=</span> <span class="n">normalize_display_type</span><span class="p">(</span><span class="n">display_type</span><span class="p">)</span>

        <span class="n">instance_templates</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;embedded_screen&#39;</span><span class="p">:</span> <span class="n">embedded_templates</span> <span class="ow">or</span> <span class="p">[],</span>
            <span class="s1">&#39;detailed_screen&#39;</span><span class="p">:</span> <span class="n">detailed_templates</span> <span class="ow">or</span> <span class="p">[],</span>
            <span class="s1">&#39;engineering_screen&#39;</span><span class="p">:</span> <span class="n">engineering_templates</span> <span class="ow">or</span> <span class="p">[],</span>
        <span class="p">}</span>
        <span class="k">for</span> <span class="n">view</span><span class="p">,</span> <span class="n">path_list</span> <span class="ow">in</span> <span class="n">instance_templates</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">paths</span> <span class="o">=</span> <span class="p">[</span><span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="n">p</span><span class="p">)</span><span class="o">.</span><span class="n">expanduser</span><span class="p">()</span><span class="o">.</span><span class="n">resolve</span><span class="p">()</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">path_list</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">templates</span><span class="p">[</span><span class="n">view</span><span class="p">]</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">paths</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_scroll_area</span> <span class="o">=</span> <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QScrollArea</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_scroll_area</span><span class="o">.</span><span class="n">setAlignment</span><span class="p">(</span><span class="n">Qt</span><span class="o">.</span><span class="n">AlignTop</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_scroll_area</span><span class="o">.</span><span class="n">setObjectName</span><span class="p">(</span><span class="s1">&#39;scroll_area&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_scroll_area</span><span class="o">.</span><span class="n">setFrameShape</span><span class="p">(</span><span class="n">QtWidgets</span><span class="o">.</span><span class="n">QFrame</span><span class="o">.</span><span class="n">StyledPanel</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_scroll_area</span><span class="o">.</span><span class="n">setVerticalScrollBarPolicy</span><span class="p">(</span><span class="n">Qt</span><span class="o">.</span><span class="n">ScrollBarAsNeeded</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_scroll_area</span><span class="o">.</span><span class="n">setWidgetResizable</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_scroll_area</span><span class="o">.</span><span class="n">setFrameStyle</span><span class="p">(</span><span class="n">QtWidgets</span><span class="o">.</span><span class="n">QFrame</span><span class="o">.</span><span class="n">NoFrame</span><span class="p">)</span>

        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">parent</span><span class="o">=</span><span class="n">parent</span><span class="p">)</span>

        <span class="n">layout</span> <span class="o">=</span> <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QHBoxLayout</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setLayout</span><span class="p">(</span><span class="n">layout</span><span class="p">)</span>
        <span class="n">layout</span><span class="o">.</span><span class="n">setContentsMargins</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_scroll_area</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">scrollable</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">scroll_option</span> <span class="o">=</span> <span class="n">scroll_option</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">scrollable</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">scroll_option</span> <span class="o">=</span> <span class="n">ScrollOptions</span><span class="o">.</span><span class="n">scrollbar</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">scroll_option</span> <span class="o">=</span> <span class="n">ScrollOptions</span><span class="o">.</span><span class="n">no_scroll</span>

    <span class="nd">@Property</span><span class="p">(</span><span class="nb">bool</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">composite_heuristics</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Allow composite screen to be suggested first by heuristics.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_composite_heuristics</span>

    <span class="nd">@composite_heuristics</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">composite_heuristics</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">composite_heuristics</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_composite_heuristics</span> <span class="o">=</span> <span class="nb">bool</span><span class="p">(</span><span class="n">composite_heuristics</span><span class="p">)</span>

    <span class="nd">@Property</span><span class="p">(</span><span class="n">_ScrollOptions</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">scroll_option</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ScrollOptions</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Place the display in a scrollable area.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scroll_option</span>

    <span class="nd">@scroll_option</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">scroll_option</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">scrollable</span><span class="p">:</span> <span class="n">ScrollOptions</span><span class="p">):</span>
        <span class="c1"># Switch the scroll area behavior</span>
        <span class="n">opt</span> <span class="o">=</span> <span class="n">normalize_scroll_option</span><span class="p">(</span><span class="n">scrollable</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">opt</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scroll_option</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_scroll_option</span> <span class="o">=</span> <span class="n">opt</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_move_display_to_layout</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_display_widget</span><span class="p">)</span>

    <span class="nd">@Property</span><span class="p">(</span><span class="nb">bool</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">hideEmpty</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Toggle hiding or showing empty panels.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_hide_empty</span>

    <span class="nd">@hideEmpty</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">hideEmpty</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">checked</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">checked</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_hide_empty</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_hide_empty</span> <span class="o">=</span> <span class="n">checked</span>

    <span class="k">def</span> <span class="nf">_move_display_to_layout</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">widget</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">widget</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="n">widget</span><span class="o">.</span><span class="n">setParent</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">scroll_option</span> <span class="o">==</span> <span class="n">ScrollOptions</span><span class="o">.</span><span class="n">auto</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">display_type</span> <span class="o">==</span> <span class="n">DisplayTypes</span><span class="o">.</span><span class="n">embedded_screen</span><span class="p">:</span>
                <span class="n">scrollable</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">scrollable</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">scroll_option</span> <span class="o">==</span> <span class="n">ScrollOptions</span><span class="o">.</span><span class="n">scrollbar</span><span class="p">:</span>
            <span class="n">scrollable</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">scroll_option</span> <span class="o">==</span> <span class="n">ScrollOptions</span><span class="o">.</span><span class="n">no_scroll</span><span class="p">:</span>
            <span class="n">scrollable</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">scrollable</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="k">if</span> <span class="n">scrollable</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_scroll_area</span><span class="o">.</span><span class="n">setWidget</span><span class="p">(</span><span class="n">widget</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">layout</span><span class="p">()</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">widget</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_scroll_area</span><span class="o">.</span><span class="n">setVisible</span><span class="p">(</span><span class="n">scrollable</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_generate_template_menu</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">base_menu</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Generate the template switcher menu, adding it to ``base_menu``.&quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">view</span><span class="p">,</span> <span class="n">filenames</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">templates</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">view</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;_screen&#39;</span><span class="p">):</span>
                <span class="n">view</span> <span class="o">=</span> <span class="n">view</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;_screen&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">menu</span> <span class="o">=</span> <span class="n">base_menu</span><span class="o">.</span><span class="n">addMenu</span><span class="p">(</span><span class="n">view</span><span class="o">.</span><span class="n">capitalize</span><span class="p">())</span>

            <span class="k">for</span> <span class="n">filename</span> <span class="ow">in</span> <span class="n">filenames</span><span class="p">:</span>
                <span class="k">def</span> <span class="nf">switch_template</span><span class="p">(</span><span class="o">*</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="n">filename</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">force_template</span> <span class="o">=</span> <span class="n">filename</span>

                <span class="n">action</span> <span class="o">=</span> <span class="n">menu</span><span class="o">.</span><span class="n">addAction</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">filename</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
                <span class="n">action</span><span class="o">.</span><span class="n">triggered</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">switch_template</span><span class="p">)</span>

        <span class="n">refresh_action</span> <span class="o">=</span> <span class="n">base_menu</span><span class="o">.</span><span class="n">addAction</span><span class="p">(</span><span class="s2">&quot;Refresh Templates&quot;</span><span class="p">)</span>
        <span class="n">refresh_action</span><span class="o">.</span><span class="n">triggered</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_refresh_templates</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_refresh_templates</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Context menu &#39;Refresh Templates&#39; clicked.&quot;&quot;&quot;</span>
        <span class="c1"># Force an update of the display cache.</span>
        <span class="n">cache</span><span class="o">.</span><span class="n">get_global_display_path_cache</span><span class="p">()</span><span class="o">.</span><span class="n">update</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">search_for_templates</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">load_best_template</span><span class="p">()</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">current_template</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get the current template being displayed.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_current_template</span>

    <span class="nd">@Property</span><span class="p">(</span><span class="n">_DisplayTypes</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">display_type</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get or set the current display type.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_display_type</span>

    <span class="nd">@display_type</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">display_type</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="n">value</span> <span class="o">=</span> <span class="n">normalize_display_type</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_display_type</span> <span class="o">!=</span> <span class="n">value</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_display_type</span> <span class="o">=</span> <span class="n">value</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">load_best_template</span><span class="p">()</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">macros</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get or set the macros for the display.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">dict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_macros</span><span class="p">)</span>

    <span class="nd">@macros</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">macros</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">macros</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_macros</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_macros</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="o">**</span><span class="p">(</span><span class="n">macros</span> <span class="ow">or</span> <span class="p">{}))</span>

        <span class="c1"># If any display macros are specified, re-search for templates:</span>
        <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">view</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_macros</span> <span class="k">for</span> <span class="n">view</span> <span class="ow">in</span> <span class="n">DisplayTypes</span><span class="o">.</span><span class="n">names</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">search_for_templates</span><span class="p">()</span>

    <span class="nd">@Property</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">designable</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">device_class</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get the full class with module name of loaded device.&quot;&quot;&quot;</span>
        <span class="n">device</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">device</span>
        <span class="bp">cls</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="o">.</span><span class="vm">__class__</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">cls</span><span class="o">.</span><span class="vm">__module__</span><span class="si">}</span><span class="s1">.</span><span class="si">{</span><span class="bp">cls</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s1">&#39;</span> <span class="k">if</span> <span class="n">device</span> <span class="k">else</span> <span class="s1">&#39;&#39;</span>

    <span class="nd">@Property</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">designable</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">device_name</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get the name of the loaded device.&quot;&quot;&quot;</span>
        <span class="n">device</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">device</span>
        <span class="k">return</span> <span class="n">device</span><span class="o">.</span><span class="n">name</span> <span class="k">if</span> <span class="n">device</span> <span class="k">else</span> <span class="s1">&#39;&#39;</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">device</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get the device associated with this Device Display.&quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">device</span><span class="p">,</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">devices</span>
            <span class="k">return</span> <span class="n">device</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="o">...</span>

<div class="viewcode-block" id="TyphosDeviceDisplay.get_best_template"><a class="viewcode-back" href="../../display.html#typhos.TyphosDeviceDisplay.get_best_template">[docs]</a>    <span class="k">def</span> <span class="nf">get_best_template</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">display_type</span><span class="p">,</span> <span class="n">macros</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the best template for the given display type.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        display_type : DisplayTypes, str, or int</span>
<span class="sd">            The display type.</span>

<span class="sd">        macros : dict</span>
<span class="sd">            Macros to use when loading the template.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">display_type</span> <span class="o">=</span> <span class="n">normalize_display_type</span><span class="p">(</span><span class="n">display_type</span><span class="p">)</span><span class="o">.</span><span class="n">name</span>

        <span class="n">templates</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">templates</span><span class="p">[</span><span class="n">display_type</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">templates</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">templates</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;No templates available for display type: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span>
                       <span class="bp">self</span><span class="o">.</span><span class="n">_display_type</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">_remove_display</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Remove the display widget, readying for a new template.&quot;&quot;&quot;</span>
        <span class="n">display_widget</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_display_widget</span>
        <span class="k">if</span> <span class="n">display_widget</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scroll_area</span><span class="o">.</span><span class="n">widget</span><span class="p">():</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_scroll_area</span><span class="o">.</span><span class="n">takeWidget</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">layout</span><span class="p">()</span><span class="o">.</span><span class="n">removeWidget</span><span class="p">(</span><span class="n">display_widget</span><span class="p">)</span>
            <span class="n">display_widget</span><span class="o">.</span><span class="n">deleteLater</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_display_widget</span> <span class="o">=</span> <span class="kc">None</span>

<div class="viewcode-block" id="TyphosDeviceDisplay.load_best_template"><a class="viewcode-back" href="../../display.html#typhos.TyphosDeviceDisplay.load_best_template">[docs]</a>    <span class="k">def</span> <span class="nf">load_best_template</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Load the best available template for the current display type.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">layout</span><span class="p">()</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># If we are not fully initialized yet do not try and add anything</span>
            <span class="c1"># to the layout. This will happen if the QApplication has a</span>
            <span class="c1"># stylesheet that forces a template prior to the creation of this</span>
            <span class="c1"># display</span>
            <span class="k">return</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_searched</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">search_for_templates</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_remove_display</span><span class="p">()</span>

        <span class="n">template</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_forced_template</span> <span class="ow">or</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">get_best_template</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_display_type</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">macros</span><span class="p">))</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">template</span><span class="p">:</span>
            <span class="n">widget</span> <span class="o">=</span> <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QWidget</span><span class="p">()</span>
            <span class="n">template</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">template</span> <span class="o">=</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="n">template</span><span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">widget</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_load_template</span><span class="p">(</span><span class="n">template</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">ex</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="s2">&quot;Unable to load file </span><span class="si">%r</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">template</span><span class="p">)</span>
                <span class="c1"># If we have a previously defined template</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_current_template</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="c1"># Fallback to it so users have a choice</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">widget</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_load_template</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_current_template</span><span class="p">)</span>
                    <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                        <span class="n">logger</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span>
                            <span class="s2">&quot;Failed to fall back to previous template: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">_current_template</span>
                        <span class="p">)</span>
                        <span class="n">template</span> <span class="o">=</span> <span class="kc">None</span>
                        <span class="n">widget</span> <span class="o">=</span> <span class="kc">None</span>

                    <span class="n">pydm</span><span class="o">.</span><span class="n">exception</span><span class="o">.</span><span class="n">raise_to_operator</span><span class="p">(</span><span class="n">ex</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">widget</span> <span class="o">=</span> <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QWidget</span><span class="p">()</span>
                    <span class="n">template</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">if</span> <span class="n">widget</span><span class="p">:</span>
            <span class="n">widget</span><span class="o">.</span><span class="n">setObjectName</span><span class="p">(</span><span class="s1">&#39;display_widget&#39;</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">widget</span><span class="o">.</span><span class="n">layout</span><span class="p">()</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">widget</span><span class="o">.</span><span class="n">minimumSize</span><span class="p">()</span><span class="o">.</span><span class="n">width</span><span class="p">()</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="c1"># If the widget has no layout, use a fixed size for it.</span>
                <span class="c1"># Without this, the widget may not display at all.</span>
                <span class="n">widget</span><span class="o">.</span><span class="n">setMinimumSize</span><span class="p">(</span><span class="n">widget</span><span class="o">.</span><span class="n">size</span><span class="p">())</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_display_widget</span> <span class="o">=</span> <span class="n">widget</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_current_template</span> <span class="o">=</span> <span class="n">template</span>

        <span class="k">def</span> <span class="nf">size_hint</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">widget</span><span class="o">.</span><span class="n">size</span><span class="p">()</span>

        <span class="c1"># sizeHint is not defined so we suggest the widget size</span>
        <span class="n">widget</span><span class="o">.</span><span class="n">sizeHint</span> <span class="o">=</span> <span class="n">size_hint</span>

        <span class="c1"># We should _move_display_to_layout as soon as it is created. This</span>
        <span class="c1"># allow us to speed up since if the widget is too complex it takes</span>
        <span class="c1"># seconds to set it to the QScrollArea</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_move_display_to_layout</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_display_widget</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_update_children</span><span class="p">()</span>
        <span class="n">utils</span><span class="o">.</span><span class="n">reload_widget_stylesheet</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></div>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">display_widget</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get the widget generated from the template.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_display_widget</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_get_templates_from_macros</span><span class="p">(</span><span class="n">macros</span><span class="p">):</span>
        <span class="n">ret</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">paths</span> <span class="o">=</span> <span class="n">cache</span><span class="o">.</span><span class="n">get_global_display_path_cache</span><span class="p">()</span><span class="o">.</span><span class="n">paths</span>
        <span class="k">for</span> <span class="n">display_type</span> <span class="ow">in</span> <span class="n">DisplayTypes</span><span class="o">.</span><span class="n">names</span><span class="p">:</span>
            <span class="n">ret</span><span class="p">[</span><span class="n">display_type</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">value</span> <span class="o">=</span> <span class="n">macros</span><span class="p">[</span><span class="n">display_type</span><span class="p">]</span>
            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                <span class="o">...</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">value</span><span class="p">:</span>
                    <span class="k">continue</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">value</span> <span class="o">=</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">ValueError</span> <span class="k">as</span> <span class="n">ex</span><span class="p">:</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;Invalid path specified in macro: </span><span class="si">%s</span><span class="s1">=</span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span>
                                 <span class="n">display_type</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">exc_info</span><span class="o">=</span><span class="n">ex</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">ret</span><span class="p">[</span><span class="n">display_type</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">utils</span><span class="o">.</span><span class="n">find_file_in_paths</span><span class="p">(</span>
                        <span class="n">value</span><span class="p">,</span> <span class="n">paths</span><span class="o">=</span><span class="n">paths</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">ret</span>

    <span class="k">def</span> <span class="nf">_load_template</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Load template from file and return the widget.&quot;&quot;&quot;</span>
        <span class="n">filename</span> <span class="o">=</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
        <span class="n">loader</span> <span class="o">=</span> <span class="p">(</span><span class="n">pydm</span><span class="o">.</span><span class="n">display</span><span class="o">.</span><span class="n">load_py_file</span> <span class="k">if</span> <span class="n">filename</span><span class="o">.</span><span class="n">suffix</span> <span class="o">==</span> <span class="s1">&#39;.py&#39;</span>
                  <span class="k">else</span> <span class="n">pydm</span><span class="o">.</span><span class="n">display</span><span class="o">.</span><span class="n">load_ui_file</span><span class="p">)</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;Load template using </span><span class="si">%s</span><span class="s1">: </span><span class="si">%r</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">loader</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">loader</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">filename</span><span class="p">),</span> <span class="n">macros</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_macros</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_update_children</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Notify child widgets of this device display + the device.&quot;&quot;&quot;</span>
        <span class="n">device</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">device</span>
        <span class="n">display</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_display_widget</span>
        <span class="n">designer</span> <span class="o">=</span> <span class="n">display</span><span class="o">.</span><span class="n">findChildren</span><span class="p">(</span><span class="n">widgets</span><span class="o">.</span><span class="n">TyphosDesignerMixin</span><span class="p">)</span> <span class="ow">or</span> <span class="p">[]</span>
        <span class="n">bases</span> <span class="o">=</span> <span class="n">display</span><span class="o">.</span><span class="n">findChildren</span><span class="p">(</span><span class="n">utils</span><span class="o">.</span><span class="n">TyphosBase</span><span class="p">)</span> <span class="ow">or</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">widget</span> <span class="ow">in</span> <span class="nb">set</span><span class="p">(</span><span class="n">bases</span> <span class="o">+</span> <span class="n">designer</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">device</span> <span class="ow">and</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">widget</span><span class="p">,</span> <span class="s1">&#39;add_device&#39;</span><span class="p">):</span>
                <span class="n">widget</span><span class="o">.</span><span class="n">add_device</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>

            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">widget</span><span class="p">,</span> <span class="s1">&#39;set_device_display&#39;</span><span class="p">):</span>
                <span class="n">widget</span><span class="o">.</span><span class="n">set_device_display</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

    <span class="nd">@Property</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">force_template</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Force a specific template.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_forced_template</span>

    <span class="nd">@force_template</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">force_template</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">value</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_forced_template</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_forced_template</span> <span class="o">=</span> <span class="n">value</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">load_best_template</span><span class="p">()</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_build_macros_from_device</span><span class="p">(</span><span class="n">device</span><span class="p">,</span> <span class="n">macros</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">result</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">device</span><span class="p">,</span> <span class="s1">&#39;md&#39;</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">device</span><span class="o">.</span><span class="n">md</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
                <span class="n">result</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">device</span><span class="o">.</span><span class="n">md</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">result</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">device</span><span class="o">.</span><span class="n">md</span><span class="o">.</span><span class="n">post</span><span class="p">())</span>

        <span class="k">if</span> <span class="s1">&#39;name&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">result</span><span class="p">:</span>
            <span class="n">result</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">device</span><span class="o">.</span><span class="n">name</span>
        <span class="k">if</span> <span class="s1">&#39;prefix&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">result</span> <span class="ow">and</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">device</span><span class="p">,</span> <span class="s1">&#39;prefix&#39;</span><span class="p">):</span>
            <span class="n">result</span><span class="p">[</span><span class="s1">&#39;prefix&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">device</span><span class="o">.</span><span class="n">prefix</span>

        <span class="n">result</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="o">**</span><span class="p">(</span><span class="n">macros</span> <span class="ow">or</span> <span class="p">{}))</span>
        <span class="k">return</span> <span class="n">result</span>

<div class="viewcode-block" id="TyphosDeviceDisplay.add_device"><a class="viewcode-back" href="../../display.html#typhos.TyphosDeviceDisplay.add_device">[docs]</a>    <span class="k">def</span> <span class="nf">add_device</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">device</span><span class="p">,</span> <span class="n">macros</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Add a Device and signals to the TyphosDeviceDisplay.</span>

<span class="sd">        The full dictionary of macros is built with the following order of</span>
<span class="sd">        precedence::</span>

<span class="sd">           1. Macros from the device metadata itself.</span>
<span class="sd">           2. If available, `name`, and `prefix` will be added from the device.</span>
<span class="sd">           3. The argument ``macros`` is then used to fill/update the final</span>
<span class="sd">              macro dictionary.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        device : ophyd.Device</span>
<span class="sd">            The device to add.</span>

<span class="sd">        macros : dict, optional</span>
<span class="sd">            Additional macros to use/replace the defaults.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># We only allow one device at a time</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">devices</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Removing devices </span><span class="si">%r</span><span class="s2">&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">devices</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">devices</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
        <span class="c1"># Add the device to the cache</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">add_device</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_searched</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">macros</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_build_macros_from_device</span><span class="p">(</span><span class="n">device</span><span class="p">,</span> <span class="n">macros</span><span class="o">=</span><span class="n">macros</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">load_best_template</span><span class="p">()</span></div>

<div class="viewcode-block" id="TyphosDeviceDisplay.search_for_templates"><a class="viewcode-back" href="../../display.html#typhos.TyphosDeviceDisplay.search_for_templates">[docs]</a>    <span class="k">def</span> <span class="nf">search_for_templates</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Search the filesystem for device-specific templates.&quot;&quot;&quot;</span>
        <span class="n">device</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">device</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">device</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;Cannot search for templates without device&#39;</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_searched</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">cls</span> <span class="o">=</span> <span class="n">device</span><span class="o">.</span><span class="vm">__class__</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;Searching for templates for </span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span> <span class="bp">cls</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
        <span class="n">macro_templates</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_templates_from_macros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_macros</span><span class="p">)</span>

        <span class="n">paths</span> <span class="o">=</span> <span class="n">cache</span><span class="o">.</span><span class="n">get_global_display_path_cache</span><span class="p">()</span><span class="o">.</span><span class="n">paths</span>
        <span class="k">for</span> <span class="n">display_type</span> <span class="ow">in</span> <span class="n">DisplayTypes</span><span class="o">.</span><span class="n">names</span><span class="p">:</span>
            <span class="n">view</span> <span class="o">=</span> <span class="n">display_type</span>
            <span class="k">if</span> <span class="n">view</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;_screen&#39;</span><span class="p">):</span>
                <span class="n">view</span> <span class="o">=</span> <span class="n">view</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;_screen&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

            <span class="n">template_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">templates</span><span class="p">[</span><span class="n">display_type</span><span class="p">]</span>
            <span class="n">template_list</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>

            <span class="c1"># 1. Highest priority: macros</span>
            <span class="k">for</span> <span class="n">template</span> <span class="ow">in</span> <span class="nb">set</span><span class="p">(</span><span class="n">macro_templates</span><span class="p">[</span><span class="n">display_type</span><span class="p">]</span> <span class="ow">or</span> <span class="p">[]):</span>
                <span class="n">template_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">template</span><span class="p">)</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;Adding macro template </span><span class="si">%s</span><span class="s1">: </span><span class="si">%s</span><span class="s1"> (total=</span><span class="si">%d</span><span class="s1">)&#39;</span><span class="p">,</span>
                             <span class="n">display_type</span><span class="p">,</span> <span class="n">template</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">template_list</span><span class="p">))</span>

            <span class="c1"># 2. Composite heuristics, if enabled</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_composite_heuristics</span> <span class="ow">and</span> <span class="n">view</span> <span class="o">==</span> <span class="s1">&#39;detailed&#39;</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">suggest_composite_screen</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
                    <span class="n">template_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">DETAILED_TREE_TEMPLATE</span><span class="p">)</span>

            <span class="c1"># 3. Templates based on class hierarchy names</span>
            <span class="n">filenames</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">find_templates_for_class</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">view</span><span class="p">,</span> <span class="n">paths</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">filename</span> <span class="ow">in</span> <span class="n">filenames</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">filename</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">template_list</span><span class="p">:</span>
                    <span class="n">template_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;Found new template </span><span class="si">%s</span><span class="s1">: </span><span class="si">%s</span><span class="s1"> (total=</span><span class="si">%d</span><span class="s1">)&#39;</span><span class="p">,</span>
                                 <span class="n">display_type</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">template_list</span><span class="p">))</span>

            <span class="c1"># 4. Default templates</span>
            <span class="n">template_list</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span>
                <span class="p">[</span><span class="n">templ</span> <span class="k">for</span> <span class="n">templ</span> <span class="ow">in</span> <span class="n">DEFAULT_TEMPLATES</span><span class="p">[</span><span class="n">display_type</span><span class="p">]</span>
                 <span class="k">if</span> <span class="n">templ</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">template_list</span><span class="p">]</span>
            <span class="p">)</span></div>

<div class="viewcode-block" id="TyphosDeviceDisplay.suggest_composite_screen"><a class="viewcode-back" href="../../display.html#typhos.TyphosDeviceDisplay.suggest_composite_screen">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">suggest_composite_screen</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">device_cls</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Suggest to use the composite screen for the given class.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        composite : bool</span>
<span class="sd">            If True, favor the composite screen.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">num_devices</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">num_signals</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">attr</span><span class="p">,</span> <span class="n">component</span> <span class="ow">in</span> <span class="n">utils</span><span class="o">.</span><span class="n">_get_top_level_components</span><span class="p">(</span><span class="n">device_cls</span><span class="p">):</span>
            <span class="n">num_devices</span> <span class="o">+=</span> <span class="nb">issubclass</span><span class="p">(</span><span class="n">component</span><span class="o">.</span><span class="n">cls</span><span class="p">,</span> <span class="n">ophyd</span><span class="o">.</span><span class="n">Device</span><span class="p">)</span>
            <span class="n">num_signals</span> <span class="o">+=</span> <span class="nb">issubclass</span><span class="p">(</span><span class="n">component</span><span class="o">.</span><span class="n">cls</span><span class="p">,</span> <span class="n">ophyd</span><span class="o">.</span><span class="n">Signal</span><span class="p">)</span>

        <span class="n">specific_screens</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_get_specific_screens</span><span class="p">(</span><span class="n">device_cls</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">specific_screens</span><span class="p">)</span> <span class="ow">or</span>
                <span class="p">(</span><span class="n">num_devices</span> <span class="o">&lt;=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">device_count_threshold</span> <span class="ow">and</span>
                 <span class="n">num_signals</span> <span class="o">&gt;=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">signal_count_threshold</span><span class="p">)):</span>
            <span class="c1"># 1. There&#39;s a custom screen - we probably should use them</span>
            <span class="c1"># 2. There aren&#39;t many devices, so the composite display isn&#39;t</span>
            <span class="c1">#    useful</span>
            <span class="c1"># 3. There are many signals, which should be broken up somehow</span>
            <span class="n">composite</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># 1. No custom screen, or</span>
            <span class="c1"># 2. Many devices or a relatively small number of signals</span>
            <span class="n">composite</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
            <span class="s1">&#39;</span><span class="si">%s</span><span class="s1"> screens=</span><span class="si">%s</span><span class="s1"> num_signals=</span><span class="si">%d</span><span class="s1"> num_devices=</span><span class="si">%d</span><span class="s1"> -&gt; composite=</span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span>
            <span class="n">device_cls</span><span class="p">,</span> <span class="n">specific_screens</span><span class="p">,</span> <span class="n">num_signals</span><span class="p">,</span> <span class="n">num_devices</span><span class="p">,</span> <span class="n">composite</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">composite</span></div>

<div class="viewcode-block" id="TyphosDeviceDisplay.from_device"><a class="viewcode-back" href="../../display.html#typhos.TyphosDeviceDisplay.from_device">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">from_device</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">device</span><span class="p">,</span> <span class="n">template</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">macros</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create a new TyphosDeviceDisplay from a Device.</span>

<span class="sd">        Loads the signals in to the appropriate positions and sets the title to</span>
<span class="sd">        a cleaned version of the device name</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        device : ophyd.Device</span>

<span class="sd">        template : str, optional</span>
<span class="sd">            Set the ``display_template``.</span>

<span class="sd">        macros : dict, optional</span>
<span class="sd">            Macro substitutions to be placed in template.</span>

<span class="sd">        **kwargs</span>
<span class="sd">            Passed to the class init.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">display</span> <span class="o">=</span> <span class="bp">cls</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="c1"># Reset the template if provided</span>
        <span class="k">if</span> <span class="n">template</span><span class="p">:</span>
            <span class="n">display</span><span class="o">.</span><span class="n">force_template</span> <span class="o">=</span> <span class="n">template</span>
        <span class="c1"># Add the device</span>
        <span class="n">display</span><span class="o">.</span><span class="n">add_device</span><span class="p">(</span><span class="n">device</span><span class="p">,</span> <span class="n">macros</span><span class="o">=</span><span class="n">macros</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">display</span></div>

<div class="viewcode-block" id="TyphosDeviceDisplay.from_class"><a class="viewcode-back" href="../../display.html#typhos.TyphosDeviceDisplay.from_class">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">from_class</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">klass</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">template</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">macros</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create a new TyphosDeviceDisplay from a Device class.</span>

<span class="sd">        Loads the signals in to the appropriate positions and sets the title to</span>
<span class="sd">        a cleaned version of the device name.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        klass : str or class</span>

<span class="sd">        template : str, optional</span>
<span class="sd">            Set the ``display_template``.</span>

<span class="sd">        macros : dict, optional</span>
<span class="sd">            Macro substitutions to be placed in template.</span>

<span class="sd">        **kwargs</span>
<span class="sd">            Extra arguments are used at device instantiation.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        TyphosDeviceDisplay</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">obj</span> <span class="o">=</span> <span class="n">pcdsutils</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">get_instance_by_name</span><span class="p">(</span><span class="n">klass</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="s1">&#39;Failed to generate TyphosDeviceDisplay from &#39;</span>
                             <span class="s1">&#39;class </span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">klass</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">None</span>

        <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">from_device</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">template</span><span class="o">=</span><span class="n">template</span><span class="p">,</span> <span class="n">macros</span><span class="o">=</span><span class="n">macros</span><span class="p">)</span></div>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">_get_specific_screens</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">device_cls</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the list of specific screens for a given device class.</span>

<span class="sd">        That is, screens that are not default Typhos-provided screens.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">[</span>
            <span class="n">template</span> <span class="k">for</span> <span class="n">template</span> <span class="ow">in</span> <span class="n">utils</span><span class="o">.</span><span class="n">find_templates_for_class</span><span class="p">(</span>
                <span class="n">device_cls</span><span class="p">,</span> <span class="s1">&#39;detailed&#39;</span><span class="p">,</span> <span class="n">utils</span><span class="o">.</span><span class="n">DISPLAY_PATHS</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">utils</span><span class="o">.</span><span class="n">is_standard_template</span><span class="p">(</span><span class="n">template</span><span class="p">)</span>
        <span class="p">]</span>

<div class="viewcode-block" id="TyphosDeviceDisplay.to_image"><a class="viewcode-back" href="../../display.html#typhos.TyphosDeviceDisplay.to_image">[docs]</a>    <span class="k">def</span> <span class="nf">to_image</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the entire display as a QtGui.QImage.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        QtGui.QImage</span>
<span class="sd">            The display, as an image.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_display_widget</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">utils</span><span class="o">.</span><span class="n">widget_to_image</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_display_widget</span><span class="p">)</span></div>

<div class="viewcode-block" id="TyphosDeviceDisplay.copy_to_clipboard"><a class="viewcode-back" href="../../display.html#typhos.TyphosDeviceDisplay.copy_to_clipboard">[docs]</a>    <span class="nd">@Slot</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">copy_to_clipboard</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Copy the display image to the clipboard.&quot;&quot;&quot;</span>
        <span class="n">image</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">to_image</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">image</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">clipboard</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QGuiApplication</span><span class="o">.</span><span class="n">clipboard</span><span class="p">()</span>
            <span class="n">clipboard</span><span class="o">.</span><span class="n">setImage</span><span class="p">(</span><span class="n">image</span><span class="p">)</span></div>

    <span class="nd">@Slot</span><span class="p">(</span><span class="nb">object</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_tx</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Receive information from happi channel.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_device</span><span class="p">(</span><span class="n">value</span><span class="p">[</span><span class="s1">&#39;obj&#39;</span><span class="p">],</span> <span class="n">macros</span><span class="o">=</span><span class="n">value</span><span class="p">[</span><span class="s1">&#39;md&#39;</span><span class="p">])</span>

    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get a custom representation for TyphosDeviceDisplay.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">(</span>
            <span class="sa">f</span><span class="s1">&#39;&lt;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s1"> at </span><span class="si">{</span><span class="nb">hex</span><span class="p">(</span><span class="nb">id</span><span class="p">(</span><span class="bp">self</span><span class="p">))</span><span class="si">}</span><span class="s1"> &#39;</span>
            <span class="sa">f</span><span class="s1">&#39;device=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">device_class</span><span class="si">}</span><span class="s1">[</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">device_name</span><span class="si">!r}</span><span class="s1">] &#39;</span>
            <span class="sa">f</span><span class="s1">&#39;nested=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_nested</span><span class="si">}</span><span class="s1">&#39;</span>
            <span class="sa">f</span><span class="s1">&#39;&gt;&#39;</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="toggle_display"><a class="viewcode-back" href="../../display.html#typhos.toggle_display">[docs]</a><span class="k">def</span> <span class="nf">toggle_display</span><span class="p">(</span><span class="n">widget</span><span class="p">,</span> <span class="n">force_state</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Toggle the visibility of all :class:`TyphosSignalPanel` in a display.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    widget : QWidget</span>
<span class="sd">        The widget in which to look for Panels.</span>

<span class="sd">    force_state : bool</span>
<span class="sd">        If set to True or False, it will change visibility to the value of</span>
<span class="sd">        force_state.</span>
<span class="sd">        If not set or set to None, it will flip the current panels state.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">panels</span> <span class="o">=</span> <span class="n">widget</span><span class="o">.</span><span class="n">findChildren</span><span class="p">(</span><span class="n">typhos_panel</span><span class="o">.</span><span class="n">TyphosSignalPanel</span><span class="p">)</span> <span class="ow">or</span> <span class="p">[]</span>
    <span class="n">visible</span> <span class="o">=</span> <span class="nb">all</span><span class="p">(</span><span class="n">panel</span><span class="o">.</span><span class="n">isVisible</span><span class="p">()</span> <span class="k">for</span> <span class="n">panel</span> <span class="ow">in</span> <span class="n">panels</span><span class="p">)</span>

    <span class="n">state</span> <span class="o">=</span> <span class="ow">not</span> <span class="n">visible</span>
    <span class="k">if</span> <span class="n">force_state</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">state</span> <span class="o">=</span> <span class="n">force_state</span>

    <span class="k">for</span> <span class="n">panel</span> <span class="ow">in</span> <span class="n">panels</span><span class="p">:</span>
        <span class="n">panel</span><span class="o">.</span><span class="n">setVisible</span><span class="p">(</span><span class="n">state</span><span class="p">)</span></div>


<div class="viewcode-block" id="show_empty"><a class="viewcode-back" href="../../display.html#typhos.show_empty">[docs]</a><span class="k">def</span> <span class="nf">show_empty</span><span class="p">(</span><span class="n">widget</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Recursively shows all panels and widgets, empty or not.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    widget : QWidget</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">children</span> <span class="o">=</span> <span class="n">widget</span><span class="o">.</span><span class="n">findChildren</span><span class="p">(</span><span class="n">TyphosDeviceDisplay</span><span class="p">)</span> <span class="ow">or</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">ch</span> <span class="ow">in</span> <span class="n">children</span><span class="p">:</span>
        <span class="n">show_empty</span><span class="p">(</span><span class="n">ch</span><span class="p">)</span>
    <span class="n">widget</span><span class="o">.</span><span class="n">setVisible</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">toggle_display</span><span class="p">(</span><span class="n">widget</span><span class="p">,</span> <span class="n">force_state</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></div>


<div class="viewcode-block" id="hide_empty"><a class="viewcode-back" href="../../display.html#typhos.hide_empty">[docs]</a><span class="k">def</span> <span class="nf">hide_empty</span><span class="p">(</span><span class="n">widget</span><span class="p">,</span> <span class="n">process_widget</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Recursively hide empty panels and widgets.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    widget : QWidget</span>
<span class="sd">        The widget in which to start the recursive search.</span>

<span class="sd">    process_widget : bool</span>
<span class="sd">        Whether or not to process the visibility for the widget.</span>
<span class="sd">        This is useful since we don&#39;t want to hide the top-most</span>
<span class="sd">        widget otherwise users can&#39;t change the visibility back on.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">process</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">recursive</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">TyphosDeviceDisplay</span><span class="p">)</span> <span class="ow">and</span> <span class="n">recursive</span><span class="p">:</span>
            <span class="n">hide_empty</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">typhos_panel</span><span class="o">.</span><span class="n">TyphosSignalPanel</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">recursive</span><span class="p">:</span>
                <span class="n">hide_empty</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
            <span class="n">visible</span> <span class="o">=</span> <span class="nb">bool</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">_panel_layout</span><span class="o">.</span><span class="n">visible_elements</span><span class="p">)</span>
            <span class="n">item</span><span class="o">.</span><span class="n">setVisible</span><span class="p">(</span><span class="n">visible</span><span class="p">)</span>

    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">widget</span><span class="p">,</span> <span class="n">TyphosDeviceDisplay</span><span class="p">):</span>
        <span class="c1"># Check if the template at this display is one of the defaults</span>
        <span class="c1"># otherwise we are not sure if we can safely change it.</span>

        <span class="k">if</span> <span class="n">widget</span><span class="o">.</span><span class="n">current_template</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">DEFAULT_TEMPLATES_FLATTEN</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Can&#39;t hide empty entries in non built-in templates&quot;</span><span class="p">)</span>
            <span class="k">return</span>

    <span class="n">children</span> <span class="o">=</span> <span class="n">widget</span><span class="o">.</span><span class="n">findChildren</span><span class="p">(</span><span class="n">utils</span><span class="o">.</span><span class="n">TyphosBase</span><span class="p">)</span> <span class="ow">or</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">w</span> <span class="ow">in</span> <span class="n">children</span><span class="p">:</span>
        <span class="n">process</span><span class="p">(</span><span class="n">w</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">process_widget</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">widget</span><span class="p">,</span> <span class="n">TyphosDeviceDisplay</span><span class="p">):</span>
            <span class="n">overall_status</span> <span class="o">=</span> <span class="nb">any</span><span class="p">(</span><span class="n">w</span><span class="o">.</span><span class="n">isVisible</span><span class="p">()</span> <span class="k">for</span> <span class="n">w</span> <span class="ow">in</span> <span class="n">children</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">widget</span><span class="p">,</span> <span class="n">typhos_panel</span><span class="o">.</span><span class="n">TyphosSignalPanel</span><span class="p">):</span>
            <span class="n">overall_status</span> <span class="o">=</span> <span class="nb">bool</span><span class="p">(</span><span class="n">widget</span><span class="o">.</span><span class="n">_panel_layout</span><span class="o">.</span><span class="n">visible_elements</span><span class="p">)</span>
        <span class="n">widget</span><span class="o">.</span><span class="n">setVisible</span><span class="p">(</span><span class="n">overall_status</span><span class="p">)</span></div>
</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2021, SLAC National Accelerator Laboratory.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>